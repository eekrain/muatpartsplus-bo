# API Integration Cursor Rule

This rule defines the standard for generating new API service files and SWR hooks in the codebase, and for integrating them into UI components.  
It ensures all API integrations are consistent, testable, and easy to maintain.

---

## 1. How to Use This Rule

When you need a new API integration, provide the required information below in the specified format.  
The AI will generate a service file in the correct location, with a fetcher, mock data, and SWR hook(s) following these conventions.  
**After the service file is created, the AI will then integrate the API call into the relevant component file, as determined by the active Cursor context.**

- If the component is generated by AI, the AI must:
  - Adjust the form state in the component to match the API contract as closely as possible.
  - Implement fetch initialization (for GET) or form submission (for POST/PUT/DELETE) using the generated service hook.
  - In the handleSubmit function, if the form state does not exactly match the request body, normalize/transform the form state to match the API contract before making the API call.

> **Note:** The user does NOT need to specify the component in the input. The component context (file or component) must be provided via Cursor context (e.g., by opening or focusing the relevant file/component in Cursor) before requesting integration.

---

## 2. Required Information Format

Provide your request in the following format (no YAML needed):

```
feature: detailpesanan
fetcher: fetcherMuatrans
POST /api/v1/orders/{orderId}/reviews

---
result
{
  "Message": {
    "Code": 201,
    "Text": "Driver review created successfully"
  },
  "Data": {
    "ratingId": "550e8400-e29b-41d4-a716-446655440090",
    "orderId": "550e8400-e29b-41d4-a716-446655440000",
    "driverId": "550e8400-e29b-41d4-a716-446655440001",
    "rating": 5,
    "review": "Driver sangat profesional dan tepat waktu. Pengiriman berjalan lancar.",
    "reviewLength": 67,
    "ratedAt": "2024-01-05T10:00:00Z"
  },
  "Type": "CREATE_DRIVER_REVIEW"
}

---
request body
{
  "driverId": "550e8400-e29b-41d4-a716-446655440001",
  "orderId": "uuid-order-123",
  "rating": 5,
  "review": "Driver sangat profesional dan tepat waktu. Pengiriman berjalan lancar."
}
---
```

- The first line is the feature folder.
- The second line is the axios fetcher to use.
- The third line is the HTTP method and endpoint (e.g., POST /api/v1/orders/{orderId}/reviews).
- After a line with '---', provide the API result contract (label as 'result').
- If the request is a mutation (POST/PUT/DELETE), provide the request body (label as 'request body').
- You may omit the request body for GET requests.

> **Note:** The user does NOT need to provide a service name. The AI will infer a suitable camelCase service name (e.g., `createDriverReview`) from the endpoint and method.

---

## 3. File and Naming Conventions

- **File Location:** `src/services/[feature]/[camelCaseServiceName].js` (e.g., `createDriverReview.js`)
- **Fetcher Function:** Exported, named as inferred camelCase (e.g., `createDriverReview`)
- **SWR Hook:**
  - For GET: `useGet[InferredServiceName]` (e.g., `useGetOrderStatusHistory`)
  - For mutations: `use[Action][Resource]` (e.g., `useCreateDriverReview`)
- **Mock Data:**
  - Always include a `mockAPIResult` object at the top of the file, matching the real API contract.
  - The mock result **must** be wrapped in a `data` property, emulating the axios result shape:
    ```js
    // Mock API result for development/testing
    export const mockAPIResult = {
      data: {
        Message: {
          Code: 201,
          Text: "Driver review created successfully",
        },
        Data: {
          ratingId: "550e8400-e29b-41d4-a716-446655440090",
          orderId: "550e8400-e29b-41d4-a716-446655440000",
          driverId: "550e8400-e29b-41d4-a716-446655440001",
          rating: 5,
          review:
            "Driver sangat profesional dan tepat waktu. Pengiriman berjalan lancar.",
          reviewLength: 67,
          ratedAt: "2024-01-05T10:00:00Z",
        },
        Type: "CREATE_DRIVER_REVIEW",
      },
    };
    ```
  - Use mock data for development and testing; remove before production if not needed.

---

## 4. SWR Hook Patterns

### For `GET` Requests

- Use `useSWR` for data fetching.
- Pass dynamic params as arguments to the hook; they are included in the SWR cache key.
- Example:
  ```js
  export const useGetOrderStatusHistory = (orderId) =>
    useSWR(`order-status-history/${orderId}`, getOrderStatusHistory);
  ```

### For `POST`, `PUT`, `DELETE` Requests

- Use `useSWRMutation` for mutations.
- **Always interpolate variables (such as IDs) directly into the SWR cache key. Do not leave placeholders like `{orderId}` in the cache key.**
- The request body is passed in the `{ arg }` object when calling the mutation's `trigger` function.
- Example:

  ```js
  // CORRECT: Interpolate orderId into the cache key
  export const useCreateDriverReview = (orderId) =>
    useSWRMutation(`/api/v1/orders/${orderId}/reviews`, (url, { arg }) =>
      fetcherMuatrans.post(url, arg)
    );
  ```

  // INCORRECT: Do NOT leave placeholders in the cache key
  // useSWRMutation("/api/v1/orders/{orderId}/reviews", ...)

  ```

  ```

---

## 5. Error Handling and Best Practices

- Always handle loading and error states in the UI.
- Use the `error` and `isLoading` values returned by SWR hooks.
- Document any non-standard error shapes in the service file.
- Prefer colocating mock data with the fetcher for easy removal later.
- When generating or updating a component:
  - Adjust the form state to match the API contract as closely as possible.
  - Normalize/transform the form state in the handleSubmit function if it does not exactly match the request body required by the API.
  - Ensure fetch initialization or form submission logic is implemented using the generated service hook.

---

## 6. Example Input

```
feature: detailpesanan
fetcher: fetcherMuatrans
POST /api/v1/orders/{orderId}/reviews

---
result
{
  "Message": {
    "Code": 201,
    "Text": "Driver review created successfully"
  },
  "Data": {
    "ratingId": "550e8400-e29b-41d4-a716-446655440090",
    "orderId": "550e8400-e29b-41d4-a716-446655440000",
    "driverId": "550e8400-e29b-41d4-a716-446655440001",
    "rating": 5,
    "review": "Driver sangat profesional dan tepat waktu. Pengiriman berjalan lancar.",
    "reviewLength": 67,
    "ratedAt": "2024-01-05T10:00:00Z"
  },
  "Type": "CREATE_DRIVER_REVIEW"
}

---
request body
{
  "driverId": "550e8400-e29b-41d4-a716-446655440001",
  "orderId": "uuid-order-123",
  "rating": 5,
  "review": "Driver sangat profesional dan tepat waktu. Pengiriman berjalan lancar."
}
---
```

---

## 7. Example Output

- A new file at `src/services/detailpesanan/createDriverReview.js` with:
  - `mockAPIResult` object
  - Exported fetcher function using the correct fetcher
  - Exported SWR mutation hook with correct cache key and parameter handling
- The relevant component file (as determined by Cursor context) will be updated to:
  - Use the new hook
  - Adjust the form state to match the API contract as closely as possible
  - Normalize the form state in handleSubmit if needed to match the request body
  - Implement fetch initialization or form submission logic
  - Handle loading, error, and success states as appropriate

---

## 8. References

- [SWR Documentation](mdc:https:/swr.vercel.app)
- [Axios Documentation](mdc:https:/axios-http.com)
- [Project API Integration Guide](mdc:../projectInstruction.md)
